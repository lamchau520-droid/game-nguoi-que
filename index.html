<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Stick RPG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;background:#6ec6ff}
canvas{display:block}
.btn{position:fixed;bottom:20px;width:60px;height:60px;border-radius:50%;border:none;font-size:24px}
#left{left:20px}
#right{left:90px}
#attack{right:20px;background:red;color:#fff}
#menu{right:90px;background:gold}
#panel{
 position:fixed;top:50%;left:50%;
 transform:translate(-50%,-50%);
 background:#222;color:#fff;
 padding:15px;border-radius:10px;
 display:none
}
#panel button{display:block;width:100%;margin:6px 0}
</style>
</head>

<body>
<canvas id="c"></canvas>

<button id="left" class="btn">‚óÄ</button>
<button id="right" class="btn">‚ñ∂</button>
<button id="attack" class="btn">‚öî</button>
<button id="menu" class="btn">Ôºã</button>

<div id="panel">
 <b>N√ÇNG C·∫§P</b>
 <button onclick="upHP()">‚ù§Ô∏è M√°u</button>
 <button onclick="upDMG()">‚öî S√°t th∆∞∆°ng</button>
 <button onclick="upAlly()">üß† Ally</button>
 <button onclick="panel.style.display='none'">ƒê√≥ng</button>
</div>

<script>
const c=document.getElementById("c"),ctx=c.getContext("2d");
c.width=innerWidth;c.height=innerHeight;

const img=s=>{let i=new Image();i.src=s;return i}
const ground=img("ground.png");
const playerImg=img("player_idle.png");
const enemyImg=img("enemy.png");
const bossImg=img("boss.png");

/* ===== PLAYER ===== */
const P={x:200,y:c.height-140,w:48,h:64,hp:100,maxHp:100,dmg:10,atk:false};

/* ===== ALLY ===== */
const ally={x:160,y:P.y,dmg:5,heal:0.05,rage:0};

/* ===== GAME ===== */
let cam=0,zone=1,contracts=0;
let enemies=[],boss=null;
let costHP=1,costDMG=1,costAlly=1;

/* ===== INPUT ===== */
let L=false,R=false;
left.ontouchstart=()=>L=true; left.ontouchend=()=>L=false;
right.ontouchstart=()=>R=true; right.ontouchend=()=>R=false;
attack.ontouchstart=()=>P.atk=true; attack.ontouchend=()=>P.atk=false;
menu.onclick=()=>panel.style.display=panel.style.display=="block"?"none":"block";

/* ===== UPGRADE ===== */
function upHP(){if(contracts>=costHP){contracts-=costHP;P.maxHp+=30;P.hp=P.maxHp;costHP++}}
function upDMG(){if(contracts>=costDMG){contracts-=costDMG;P.dmg+=5;costDMG++}}
function upAlly(){if(contracts>=costAlly){contracts-=costAlly;ally.dmg+=3;ally.heal+=0.03;costAlly++}}

/* ===== ZONE ===== */
function checkZone(){
 let z=P.x<1200?1:P.x<2400?2:3;
 if(z!==zone){zone=z;spawn()}
}

/* ===== SPAWN ===== */
function spawn(){
 enemies=[];
 for(let i=0;i<5;i++){
  let rare=Math.random()<0.1;
  enemies.push({
   x:P.x+300+i*200,
   y:P.y,
   hp:rare?120:40,
   dmg:rare?1.2:0.4,
   rare:rare
  });
 }
 boss={
  x:P.x+1200,
  y:P.y-20,
  hp:120+zone*80,
  maxHp:120+zone*80
 };
}

/* ===== LOOP ===== */
spawn();
function update(){
 if(L)P.x-=4;
 if(R)P.x+=4;
 cam=Math.max(0,P.x-200);
 checkZone();

 ally.x=P.x-40;
 if(P.hp<P.maxHp)P.hp+=ally.heal;
 ally.rage+=0.2;

 enemies.forEach(e=>{
  e.x+=e.x>P.x?-0.5:0.5;
  if(Math.abs(e.x-P.x)<40)P.hp-=e.dmg;
  if(P.atk&&Math.abs(e.x-P.x)<50)e.hp-=P.dmg;
  if(Math.abs(e.x-ally.x)<40)e.hp-=ally.dmg;

  if(e.hp<=0 && e.rare) contracts+=2;
 });

 enemies=enemies.filter(e=>e.hp>0);

 if(boss&&boss.hp>0){
  boss.x+=boss.x>P.x?-0.6:0.6;
  if(Math.abs(boss.x-P.x)<60)P.hp-=0.6;
  if(P.atk&&Math.abs(boss.x-P.x)<70)boss.hp-=P.dmg;
  if(ally.rage>=100){boss.hp-=20;ally.rage=0}
  if(boss.hp<=0){contracts+=zone;spawn()}
 }

 if(P.hp<=0)location.reload();
}

function draw(){
 ctx.clearRect(0,0,c.width,c.height);

 for(let i=0;i<60;i++)
  ctx.drawImage(ground,i*64-cam%64,c.height-64,64,64);

 enemies.forEach(e=>{
  if(e.rare){
   ctx.fillStyle="gold";
   ctx.fillRect(e.x-cam-4,e.y-6,56,4);
  }
  ctx.drawImage(enemyImg,e.x-cam,e.y,48,48);
 });

 if(boss&&boss.hp>0){
  ctx.drawImage(bossImg,boss.x-cam,boss.y,80,80);
  ctx.fillStyle="red";
  ctx.fillRect(boss.x-cam,boss.y-8,80*(boss.hp/boss.maxHp),5);
 }

 ctx.drawImage(playerImg,P.x-cam,P.y,P.w,P.h);
 ctx.fillStyle="blue";
 ctx.fillRect(ally.x-cam,ally.y,20,20);

 ctx.fillStyle="red";
 ctx.fillRect(20,20,200*(P.hp/P.maxHp),10);
 ctx.strokeRect(20,20,200,10);
 ctx.fillStyle="#000";
 ctx.fillText("Kh·∫ø ∆∞·ªõc: "+contracts,20,50);
}

function loop(){update();draw();requestAnimationFrame(loop)}
loop();
</script>
</body>
</html>
