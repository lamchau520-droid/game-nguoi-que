<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Pixel RPG Full</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
body{margin:0;background:#000;color:#fff}
canvas{display:block;margin:auto;background:#7ec0ee}
#ui{position:fixed;top:5px;left:5px;background:rgba(0,0,0,.6);padding:6px;border-radius:8px}
#controls{position:fixed;bottom:10px;left:0;right:0;text-align:center}
button{font-size:20px;padding:10px;margin:3px;border-radius:10px}
</style>
</head>

<body>
<div id="ui">
HP:<span id="hp">100</span><br>
Boss:<span id="bossHp">200</span>
</div>

<canvas id="game" width="360" height="600"></canvas>

<div id="controls">
<button onclick="move(0,-1)">⬆</button><br>
<button onclick="move(-1,0)">⬅</button>
<button onclick="attack()">⚔</button>
<button onclick="move(1,0)">➡</button><br>
<button onclick="move(0,1)">⬇</button>
</div>

<script>
const c=document.getElementById("game");
const ctx=c.getContext("2d");

const playerImg=new Image(); playerImg.src="player.png";
const bossImg=new Image(); bossImg.src="boss.png";
const petImg=new Image(); petImg.src="pet.png";

let frame=0;

const player={x:160,y:380,dir:0,frame:0,hp:100};
const pet={x:140,y:400,frame:0};
const boss={x:120,y:200,hp:200,phase:1,frame:0};

function move(dx,dy){
  player.x+=dx*15;
  player.y+=dy*15;
  if(dx>0)player.dir=2;
  if(dx<0)player.dir=1;
  if(dy>0)player.dir=0;
  if(dy<0)player.dir=3;
  player.frame=(player.frame+1)%4;
}

function attack(){
  if(Math.abs(player.x-boss.x)<50){
    boss.hp-=20;
    if(boss.hp<100) boss.phase=2;
    if(boss.hp<=0){
      alert("Bạn đã hạ boss cuối!");
      boss.hp=200;
      boss.phase=1;
    }
  }
}

function drawPlayer(){
  ctx.drawImage(
    playerImg,
    player.frame*32, player.dir*32,
    32,32,
    player.x,player.y,
    32,32
  );
}

function drawPet(){
  pet.x += (player.x-30-pet.x)*0.1;
  pet.y += (player.y+10-pet.y)*0.1;
  pet.frame=(pet.frame+1)%3;
  ctx.drawImage(
    petImg,
    pet.frame*32,0,
    32,32,
    pet.x,pet.y,
    24,24
  );
}

function drawBoss(){
  let f=boss.phase===1?0:2;
  ctx.drawImage(
    bossImg,
    f*64,0,
    64,64,
    boss.x,boss.y,
    64,64
  );
}

function loop(){
  frame++;
  ctx.clearRect(0,0,c.width,c.height);

  ctx.fillStyle="#1f7a1f";
  ctx.fillRect(0,300,c.width,300);

  drawBoss();
  drawPet();
  drawPlayer();

  document.getElementById("hp").innerText=player.hp;
  document.getElementById("bossHp").innerText=boss.hp;

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
