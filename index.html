<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Game Người Que</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;background:#6ec6ff}
canvas{display:block}
.btn{
 position:fixed;bottom:20px;
 width:60px;height:60px;
 border-radius:50%;
 border:none;font-size:24px
}
#left{left:20px}
#right{left:90px}
#attack{right:20px;background:red;color:#fff}
</style>
</head>

<body>
<canvas id="c"></canvas>

<button id="left" class="btn">◀</button>
<button id="right" class="btn">▶</button>
<button id="attack" class="btn">⚔</button>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

const img=s=>{let i=new Image();i.src=s;return i}
const ground=img("ground.png");
const pIdle=img("player_idle.png");
const pWalk=img("player_walk.png");
const pAtk=img("player_attack.png");
const enemyImg=img("enemy.png");
const bossImg=img("boss.png");

/* ===== PLAYER ===== */
const player={
 x:200,y:canvas.height-140,
 w:48,h:64,
 hp:100,maxHp:100,
 dir:1,atk:false,moving:false
};

/* ===== ENEMY ===== */
let enemies=[];
for(let i=0;i<6;i++){
 enemies.push({x:500+i*350,y:canvas.height-140,hp:30});
}

/* ===== BOSS ===== */
const boss={
 x:2600,y:canvas.height-160,
 w:80,h:80,
 hp:150
};

let camX=0;
let gameOver=false;

/* ===== INPUT ===== */
let L=false,R=false;
left.ontouchstart=()=>L=true;
left.ontouchend=()=>L=false;
right.ontouchstart=()=>R=true;
right.ontouchend=()=>R=false;
attack.ontouchstart=()=>{
 if(!gameOver){
  player.atk=true;
  setTimeout(()=>player.atk=false,300);
 }
};

/* ===== UPDATE ===== */
function update(){
 if(gameOver) return;

 player.moving=false;
 if(L){player.x-=4;player.dir=-1;player.moving=true}
 if(R){player.x+=4;player.dir=1;player.moving=true}

 camX=player.x-200;
 if(camX<0) camX=0;

 /* Enemy AI */
 enemies.forEach(e=>{
  e.x+=e.x>player.x?-0.6:0.6;

  if(Math.abs(e.x-player.x)<40){
   player.hp-=0.3;
  }
  if(player.atk && Math.abs(e.x-player.x)<50){
   e.hp-=10;
  }
 });

 enemies=enemies.filter(e=>e.hp>0);

 /* Boss AI */
 if(boss.hp>0){
  boss.x+=boss.x>player.x?-0.8:0.8;
  if(Math.abs(boss.x-player.x)<60){
   player.hp-=0.6;
  }
  if(player.atk && Math.abs(boss.x-player.x)<70){
   boss.hp-=5;
  }
 }

 if(player.hp<=0){
  player.hp=0;
  gameOver=true;
 }
}

/* ===== DRAW ===== */
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 /* Ground */
 for(let i=0;i<60;i++)
  ctx.drawImage(ground,i*64-camX%64,canvas.height-64,64,64);

 /* Enemies */
 enemies.forEach(e=>{
  ctx.drawImage(enemyImg,e.x-camX,e.y,48,48);
 });

 /* Boss */
 if(boss.hp>0){
  ctx.drawImage(bossImg,boss.x-camX,boss.y,boss.w,boss.h);
  ctx.fillStyle="red";
  ctx.fillRect(boss.x-camX,boss.y-8,boss.w*(boss.hp/150),5);
 }

 /* Player */
 let pImg=pIdle;
 if(player.atk)pImg=pAtk;
 else if(player.moving)pImg=pWalk;

 ctx.save();
 ctx.translate(player.x-camX+player.w/2,player.y);
 ctx.scale(player.dir,1);
 ctx.drawImage(pImg,-player.w/2,0,player.w,player.h);
 ctx.restore();

 /* UI */
 ctx.fillStyle="red";
 ctx.fillRect(20,20,200*(player.hp/player.maxHp),12);
 ctx.strokeRect(20,20,200,12);
 ctx.fillStyle="#000";
 ctx.fillText("HP",20,16);

 if(gameOver){
  ctx.fillStyle="rgba(0,0,0,0.6)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff";
  ctx.font="40px Arial";
  ctx.fillText("GAME OVER",canvas.width/2-120,canvas.height/2);
 }
}

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
