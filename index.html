<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Pixel World RPG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<style>
body { margin:0; background:#000; overflow:hidden }
canvas { display:block; margin:auto; background:#87ceeb }
#ui {
  position:fixed; top:10px; left:10px;
  color:#fff; background:rgba(0,0,0,.6);
  padding:8px; border-radius:8px;
  font-size:14px
}
#ctrl {
  position:fixed; bottom:10px; left:50%;
  transform:translateX(-50%);
}
button {
  font-size:18px; margin:5px;
  padding:10px 14px; border-radius:8px;
}
</style>
</head>
<body>

<div id="ui">
LV: <span id="lv">1</span><br>
HP: <span id="hp">100</span><br>
Pet: Slime
</div>

<canvas id="game" width="360" height="640"></canvas>

<div id="ctrl">
<button onclick="move(-1)">â¬…</button>
<button onclick="attack()">âš”</button>
<button onclick="move(1)">âž¡</button>
</div>

<script>
const cvs = document.getElementById("game");
const ctx = cvs.getContext("2d");

const playerImg = new Image();
playerImg.src = "player.png";

const bossImg = new Image();
bossImg.src = "boss.png";

const petImg = new Image();
petImg.src = "pet.png";

let frame = 0;

const player = {
  x:160, y:460, w:48, h:48,
  hp:100, lv:1, dir:1
};

const pet = {
  x:140, y:500
};

const boss = {
  x:120, y:200, w:96, h:64,
  hp:300, active:true
};

function move(d){
  player.x += d*10;
  player.dir = d;
}

function attack(){
  if(Math.abs(player.x - boss.x) < 60){
    boss.hp -= 20;
    if(boss.hp <= 0){
      boss.active = false;
      alert("ðŸŽ‰ ÄÃ£ háº¡ boss!");
    }
  }
}

function drawPlayer(){
  ctx.drawImage(
    playerImg,
    frame*32, 0, 32, 32,
    player.x, player.y, player.w, player.h
  );
}

function drawPet(){
  ctx.drawImage(
    petImg,
    frame*32, 0, 32, 32,
    player.x - 30, player.y + 20, 32, 32
  );
}

function drawBoss(){
  if(!boss.active) return;
  ctx.drawImage(
    bossImg,
    frame*64, 0, 64, 64,
    boss.x, boss.y, boss.w, boss.h
  );
}

function loop(){
  ctx.clearRect(0,0,cvs.width,cvs.height);

  // Ä‘áº¥t
  ctx.fillStyle="#1b5e20";
  ctx.fillRect(0,520,360,120);

  drawBoss();
  drawPet();
  drawPlayer();

  frame = (frame+1)%3;
  document.getElementById("hp").innerText = player.hp;
  document.getElementById("lv").innerText = player.lv;

  requestAnimationFrame(loop);
}

loop();

// PWA
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
