<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Game Map Dài</title>
<style>
body { margin:0; background:#000; touch-action:none; }
canvas { display:block; margin:auto; background:#7dd3fc; }

button{
  position:fixed;
  bottom:20px;
  width:70px;
  height:70px;
  border-radius:50%;
  font-size:20px;
  opacity:0.7;
}
#left{ left:20px }
#right{ left:100px }
#attack{ right:20px; background:red; color:white }
</style>
</head>
<body>

<canvas id="game" width="360" height="200"></canvas>

<button id="left">◀</button>
<button id="right">▶</button>
<button id="attack">⚔</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ===== MAP =====
const mapWidth = 2000; // MAP DÀI
let cameraX = 0;

// ===== ẢNH =====
const runImg = new Image();
runImg.src = "player_run.png";
const attackImg = new Image();
attackImg.src = "player_attack.png";

// ===== PLAYER =====
const frameW = 40, frameH = 40;
let player = {
  x: 100,
  y: 120,
  speed: 2,
  frame: 0,
  state: "idle",
  facing: 1
};

// ===== NÚT =====
let left=false, right=false;

document.getElementById("left").ontouchstart=()=>left=true;
document.getElementById("left").ontouchend=()=>left=false;

document.getElementById("right").ontouchstart=()=>right=true;
document.getElementById("right").ontouchend=()=>right=false;

document.getElementById("attack").ontouchstart=()=>{
  player.state="attack";
  player.frame=0;
};

// ===== UPDATE =====
function update(){
  if(player.state==="attack"){
    player.frame+=0.15;
    if(player.frame>=2){
      player.state="idle";
      player.frame=0;
    }
    return;
  }

  if(left){
    player.x-=player.speed;
    player.facing=-1;
    player.state="run";
  }
  else if(right){
    player.x+=player.speed;
    player.facing=1;
    player.state="run";
  }
  else{
    player.state="idle";
    player.frame=0;
  }

  if(player.state==="run"){
    player.frame+=0.15;
    if(player.frame>=4) player.frame=0;
  }

  // GIỚI HẠN MAP
  player.x=Math.max(0,Math.min(player.x,mapWidth-frameW));

  // CAMERA THEO PLAYER
  cameraX = player.x - canvas.width/2;
  cameraX = Math.max(0, Math.min(cameraX, mapWidth-canvas.width));
}

// ===== DRAW =====
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // NỀN MAP
  ctx.fillStyle="#4ade80";
  ctx.fillRect(-cameraX,160,mapWidth,40);

  ctx.save();
  ctx.scale(player.facing,1);

  let img = player.state==="attack"?attackImg:runImg;
  let fx = Math.floor(player.frame)*frameW;

  ctx.drawImage(
    img,
    fx,0,frameW,frameH,
    player.facing===1 ? player.x-cameraX : -(player.x-cameraX)-frameW,
    player.y,
    frameW,frameH
  );

  ctx.restore();
}

// ===== LOOP =====
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
