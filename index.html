<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Game Người Que</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #6ec6ff;
  }
  canvas {
    display: block;
  }
  .btn {
    position: fixed;
    bottom: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    font-size: 24px;
  }
  #left { left: 20px; }
  #right { left: 90px; }
  #attack { right: 20px; background: red; color: white; }
</style>
</head>

<body>

<canvas id="game"></canvas>

<button id="left" class="btn">◀</button>
<button id="right" class="btn">▶</button>
<button id="attack" class="btn">✖</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ===== LOAD ẢNH =====
const groundImg = new Image();
groundImg.src = "ground.png";

const playerIdle = new Image();
playerIdle.src = "player_idle.png";

const playerWalk = new Image();
playerWalk.src = "player_walk.png";

const playerAttack = new Image();
playerAttack.src = "player_attack.png";

const bossImg = new Image();
bossImg.src = "boss.png";

// ===== PLAYER =====
const player = {
  x: 200,
  y: canvas.height - 140,
  w: 48,
  h: 64,
  speed: 4,
  dir: 1,
  attacking: false,
  moving: false
};

// ===== BOSS =====
const boss = {
  x: 600,
  y: canvas.height - 150,
  w: 80,
  h: 80,
  hp: 100
};

let camX = 0;

// ===== INPUT =====
let left = false;
let right = false;

document.getElementById("left").ontouchstart = () => left = true;
document.getElementById("left").ontouchend = () => left = false;

document.getElementById("right").ontouchstart = () => right = true;
document.getElementById("right").ontouchend = () => right = false;

document.getElementById("attack").ontouchstart = () => {
  player.attacking = true;
  setTimeout(() => player.attacking = false, 300);
  if (Math.abs(player.x - boss.x) < 80) {
    boss.hp -= 10;
  }
};

// ===== UPDATE =====
function update() {
  player.moving = false;

  if (left) {
    player.x -= player.speed;
    player.dir = -1;
    player.moving = true;
  }
  if (right) {
    player.x += player.speed;
    player.dir = 1;
    player.moving = true;
  }

  camX = player.x - 200;
  if (camX < 0) camX = 0;
}

// ===== DRAW =====
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // NỀN TRỜI
  ctx.fillStyle = "#6ec6ff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // GROUND LẶP
  for (let i = -1; i < 50; i++) {
    ctx.drawImage(
      groundImg,
      i * 64 - camX % 64,
      canvas.height - 64,
      64,
      64
    );
  }

  // PLAYER
  let img = playerIdle;
  if (player.attacking) img = playerAttack;
  else if (player.moving) img = playerWalk;

  ctx.save();
  ctx.translate(player.x - camX + player.w / 2, player.y);
  ctx.scale(player.dir, 1);
  ctx.drawImage(img, -player.w / 2, 0, player.w, player.h);
  ctx.restore();

  // ===== BOSS (CHỈ VẼ 1 LẦN) =====
  if (boss.hp > 0) {
    ctx.drawImage(
      bossImg,
      boss.x - camX,
      boss.y,
      boss.w,
      boss.h
    );

    // MÁU BOSS
    ctx.fillStyle = "red";
    ctx.fillRect(
      boss.x - camX,
      boss.y - 10,
      boss.w * (boss.hp / 100),
      6
    );
  }
}

// ===== LOOP (CHỈ 1 LẦN) =====
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
