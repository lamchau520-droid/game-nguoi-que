<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixel World RPG</title>
<style>
body{margin:0;background:#000;overflow:hidden;}
canvas{display:block;margin:auto;background:#8fd3ff;}
#ui{
  position:fixed;top:10px;left:10px;
  color:white;background:rgba(0,0,0,.6);
  padding:8px;border-radius:8px;font-size:14px;
}
.controls{
  position:fixed;bottom:20px;width:100%;
  display:flex;justify-content:center;gap:20px;
}
.btn{width:60px;height:60px;font-size:24px;border-radius:12px;}
</style>
</head>

<body>

<div id="ui">
LV: 1<br>
HP: 100<br>
Gold: <span id="gold">0</span>
</div>

<canvas id="game" width="360" height="640"></canvas>

<div class="controls">
  <button class="btn" onclick="moveLeft()">←</button>
  <button class="btn" onclick="attack()">⚔</button>
  <button class="btn" onclick="moveRight()">→</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let gold = 0;

// ===== PLAYER =====
const player = {x:160,y:420,w:32,h:32,speed:2,moving:false,frame:0,tick:0};

// ===== PLAYER IMAGES =====
const imgIdle = new Image(); imgIdle.src="player_idle.png";
const imgRun1 = new Image(); imgRun1.src="player_run1.png";
const imgRun2 = new Image(); imgRun2.src="player_run2.png";

// ===== BOSS =====
const bossImg = new Image(); bossImg.src="boss.png";
const boss = {
  x:200,y:380,w:40,h:40,
  frame:0,attacking:false,
  hp:30,alive:true,
  dir:1,speed:0.5
};

// ===== COIN =====
const coinImg = new Image(); coinImg.src="coin.png";
const coins = [];

// ===== DRAW PLAYER =====
function drawPlayer(){
  let img = imgIdle;
  if(player.moving) img = player.frame ? imgRun2 : imgRun1;
  ctx.drawImage(img, player.x, player.y, player.w, player.h);
}

// ===== DRAW BOSS =====
function drawBoss(){
  if(!boss.alive) return;
  ctx.drawImage(
    bossImg,
    boss.frame*40,0,40,40,
    boss.x,boss.y,40,40
  );
}

// ===== BOSS MOVE =====
function updateBoss(){
  if(!boss.alive) return;

  boss.x += boss.speed * boss.dir;
  if(boss.x < 50 || boss.x > 270) boss.dir *= -1;

  if(boss.attacking){
    boss.frame = 1;
    boss.attackTick++;
    if(boss.attackTick > 20){
      boss.attacking = false;
      boss.frame = 0;
    }
  }
}

// ===== ATTACK =====
function attack(){
  if(!boss.alive) return;

  const hit =
    player.x < boss.x + boss.w &&
    player.x + player.w > boss.x;

  if(hit){
    boss.hp -= 10;
    boss.attacking = true;
    boss.attackTick = 0;

    if(boss.hp <= 0){
      boss.alive = false;
      dropCoin();
    }
  }
}

// ===== DROP GOLD =====
function dropCoin(){
  coins.push({
    x: boss.x + 10,
    y: boss.y,
    vy: -2
  });
}

// ===== UPDATE COIN =====
function updateCoins(){
  for(let i=coins.length-1;i>=0;i--){
    const c = coins[i];
    c.vy += 0.2;
    c.y += c.vy;

    if(
      c.x < player.x + player.w &&
      c.x + 16 > player.x &&
      c.y < player.y + player.h
    ){
      gold += 10;
      document.getElementById("gold").innerText = gold;
      coins.splice(i,1);
    }
  }
}

// ===== DRAW COIN =====
function drawCoins(){
  coins.forEach(c=>{
    ctx.drawImage(coinImg,c.x,c.y,16,16);
  });
}

// ===== CONTROLS =====
function moveLeft(){player.x-=player.speed;player.moving=true;}
function moveRight(){player.x+=player.speed;player.moving=true;}

// ===== GAME LOOP =====
function gameLoop(){
  ctx.clearRect(0,0,360,640);

  ctx.fillStyle="#8fd3ff";
  ctx.fillRect(0,0,360,640);

  ctx.fillStyle="#1f7a1f";
  ctx.fillRect(0,480,360,160);

  player.tick++;
  if(player.tick>15){
    player.frame=(player.frame+1)%2;
    player.tick=0;
  }

  updateBoss();
  updateCoins();

  drawBoss();
  drawCoins();
  drawPlayer();

  player.moving=false;
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
